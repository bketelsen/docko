---
phase: 13-envrc-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [".envrc.example"]
autonomous: true

must_haves:
  truths:
    - "All 22 environment variables from codebase audit are documented in .envrc.example"
    - "Each variable has a descriptive comment explaining purpose and requirements"
    - "Variables are organized into logical category sections"
    - "Required vs optional status is clearly indicated for each variable"
  artifacts:
    - path: ".envrc.example"
      provides: "Complete environment configuration template"
      contains: "ADMIN_PASSWORD, SESSION_SECRET, STORAGE_PATH, INBOX_PATH, OPENAI_API_KEY, ANTHROPIC_API_KEY, OLLAMA_HOST"
  key_links:
    - from: ".envrc.example"
      to: "internal/config/config.go"
      via: "os.Getenv calls"
      pattern: "All config.go env vars documented"
    - from: ".envrc.example"
      to: "internal/ai/*.go"
      via: "AI provider env vars"
      pattern: "OPENAI_API_KEY, ANTHROPIC_API_KEY, OLLAMA_*"
---

<objective>
Update .envrc.example to document all 22 environment variables used by the docko application.

Purpose: Ensure new developers and deployments have complete documentation of all configuration options, with clear guidance on required vs optional settings and proper categorization.

Output: Complete .envrc.example file with all variables documented in organized sections.
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-envrc-verification/13-RESEARCH.md
@.envrc.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update .envrc.example with complete variable documentation</name>
  <files>.envrc.example</files>
  <action>
Rewrite .envrc.example with all 22 environment variables organized into these sections:

```
# =============================================================================
# Database
# =============================================================================
DATABASE_URL (REQUIRED)

# =============================================================================
# Server
# =============================================================================
PORT (optional, default: 3000)
ENV (optional, default: development)
LOG_LEVEL (optional, default: INFO)

# =============================================================================
# Site / SEO
# =============================================================================
SITE_NAME (optional, default: docko)
SITE_URL (optional, default: http://localhost:3000)
DEFAULT_OG_IMAGE (optional, default: /static/images/og-default.png)

# =============================================================================
# Authentication
# =============================================================================
ADMIN_PASSWORD (REQUIRED for auth)
SESSION_SECRET (optional - auto-generated in development)
SESSION_MAX_AGE (optional, default: 24 hours)

# =============================================================================
# Storage
# =============================================================================
STORAGE_PATH (optional, default: ./storage)

# =============================================================================
# Inbox (Document Ingestion)
# =============================================================================
INBOX_PATH (optional - disabled if not set)
INBOX_ERROR_SUBDIR (optional, default: errors)
INBOX_MAX_FILE_SIZE_MB (optional, default: 100)
INBOX_SCAN_INTERVAL_MS (optional, default: 1000)

# =============================================================================
# Network Sources (SMB/NFS)
# =============================================================================
CREDENTIAL_ENCRYPTION_KEY (REQUIRED for network sources)

# =============================================================================
# AI Providers
# =============================================================================
OPENAI_API_KEY (optional)
ANTHROPIC_API_KEY (optional)
OLLAMA_HOST (optional, default: http://localhost:11434)
OLLAMA_MODEL (optional, default: llama3.2)

# =============================================================================
# Testing
# =============================================================================
TEST_DATABASE_URL (optional, uses DATABASE_URL if not set)
TEST_PDF_WITH_TEXT (optional)
```

For each variable include:
1. Comment explaining what it does
2. Whether it's REQUIRED or optional
3. Default value if optional
4. Example value format
5. Generation command for secrets (openssl rand -base64 32)

Use placeholder values like "changeme123", "your-api-key-here" - never real-looking API keys.

Keep existing DATABASE_URL docker-compose comment for context.
  </action>
  <verify>
Count variables in updated file:
```bash
grep -c "^export " .envrc.example
```
Should return 22 (or close - some may be commented examples).

Verify key sections exist:
```bash
grep -E "^# ===" .envrc.example | wc -l
```
Should return 9 (one for each category section).
  </verify>
  <done>
.envrc.example contains all 22 environment variables from the codebase audit, organized into 9 category sections, with descriptive comments for each variable.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify completeness against codebase</name>
  <files>None (verification only)</files>
  <action>
Run grep to find all os.Getenv calls in the codebase and verify each is documented in .envrc.example:

1. Extract all env var names from codebase:
```bash
grep -rh "os\.Getenv\|getEnvOrDefault\|getEnvIntOrDefault" internal/ cmd/ --include="*.go" | \
  grep -oE '"[A-Z_]+"' | sort -u
```

2. For each variable found, verify it exists in .envrc.example:
```bash
# Check each variable from research list
for var in DATABASE_URL PORT ENV LOG_LEVEL SITE_NAME SITE_URL DEFAULT_OG_IMAGE \
           ADMIN_PASSWORD SESSION_SECRET SESSION_MAX_AGE STORAGE_PATH \
           INBOX_PATH INBOX_ERROR_SUBDIR INBOX_MAX_FILE_SIZE_MB INBOX_SCAN_INTERVAL_MS \
           CREDENTIAL_ENCRYPTION_KEY OPENAI_API_KEY ANTHROPIC_API_KEY \
           OLLAMA_HOST OLLAMA_MODEL TEST_DATABASE_URL TEST_PDF_WITH_TEXT; do
  grep -q "$var" .envrc.example || echo "MISSING: $var"
done
```

3. If any variables are missing, add them to the appropriate section.
  </action>
  <verify>
```bash
# This should output nothing (all variables present)
for var in DATABASE_URL PORT ENV LOG_LEVEL SITE_NAME SITE_URL DEFAULT_OG_IMAGE \
           ADMIN_PASSWORD SESSION_SECRET SESSION_MAX_AGE STORAGE_PATH \
           INBOX_PATH INBOX_ERROR_SUBDIR INBOX_MAX_FILE_SIZE_MB INBOX_SCAN_INTERVAL_MS \
           CREDENTIAL_ENCRYPTION_KEY OPENAI_API_KEY ANTHROPIC_API_KEY \
           OLLAMA_HOST OLLAMA_MODEL TEST_DATABASE_URL TEST_PDF_WITH_TEXT; do
  grep -q "$var" .envrc.example || echo "MISSING: $var"
done
```
  </verify>
  <done>
All environment variables from the codebase audit are confirmed present in .envrc.example. No undocumented variables exist.
  </done>
</task>

</tasks>

<verification>
1. Variable count: `grep -c "export\|^#.*export" .envrc.example` shows all 22 variables (some commented as examples)
2. Section count: `grep -c "^# ===" .envrc.example` returns 9
3. No missing variables from verification script
4. File is valid bash (can be sourced without errors)
</verification>

<success_criteria>
1. All 22 environment variables from research audit are in .envrc.example
2. Each variable has descriptive comment with required/optional status
3. Variables organized into 9 logical category sections
4. Placeholder values used (no real API keys)
5. .envrc remains gitignored (no changes to .gitignore needed)
</success_criteria>

<output>
After completion, create `.planning/phases/13-envrc-verification/13-01-SUMMARY.md`
</output>
