---
phase: 15-pending-fixes
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/pages/admin/tags.templ
  - templates/pages/admin/correspondents.templ
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Clicking Edit on Tags page opens edit modal with tag data pre-filled"
    - "Clicking Edit on Correspondents page opens edit modal with correspondent data pre-filled"
  artifacts:
    - path: "templates/pages/admin/tags.templ"
      provides: "Working onclick for edit button"
      contains: "templ.JSFuncCall.*\\.Call"
    - path: "templates/pages/admin/correspondents.templ"
      provides: "Working onclick for edit button"
      contains: "templ.JSFuncCall.*\\.Call"
  key_links:
    - from: "tags.templ edit button onclick"
      to: "openEditMode JavaScript function"
      via: "templ.JSFuncCall().Call generates escaped JS string"
    - from: "correspondents.templ edit button onclick"
      to: "openEditMode JavaScript function"
      via: "templ.JSFuncCall().Call generates escaped JS string"
---

<objective>
Fix edit buttons on Tags and Correspondents pages that silently fail when clicked.

Purpose: Both edit buttons use templ.JSFuncCall() which returns a ComponentScript struct. When passed to templ.Attributes map, templ silently drops it because RenderAttributes has no case for ComponentScript type. The .Call property returns the properly escaped JavaScript string needed for onclick handlers.

Output: Working edit buttons that open modals with pre-filled data.
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-pending-fixes/15-UAT.md
@templates/pages/admin/tags.templ
@templates/pages/admin/correspondents.templ
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix templ.JSFuncCall onclick handlers</name>
  <files>
    templates/pages/admin/tags.templ
    templates/pages/admin/correspondents.templ
  </files>
  <action>
    In tags.templ around line 243, change:
    ```
    "onclick": templ.JSFuncCall("openEditMode", tag.ID.String(), tag.Name, safeColor(tag.Color)),
    ```
    to:
    ```
    "onclick": templ.JSFuncCall("openEditMode", tag.ID.String(), tag.Name, safeColor(tag.Color)).Call,
    ```

    In correspondents.templ around line 461, change:
    ```
    "onclick": templ.JSFuncCall("openEditMode", correspondent.ID.String(), correspondent.Name, safeNotes(correspondent.Notes)),
    ```
    to:
    ```
    "onclick": templ.JSFuncCall("openEditMode", correspondent.ID.String(), correspondent.Name, safeNotes(correspondent.Notes)).Call,
    ```

    The .Call property converts the ComponentScript struct to the escaped JavaScript string that onclick expects.
  </action>
  <verify>
    1. Check ./tmp/air-combined.log for compilation errors
    2. Visit /tags, click Edit on any tag - modal should open with tag name and color pre-filled
    3. Visit /correspondents, click Edit on any correspondent - modal should open with name and notes pre-filled
  </verify>
  <done>
    Edit buttons on both Tags and Correspondents pages open their respective edit modals with data pre-filled.
  </done>
</task>

</tasks>

<verification>
1. `make generate` completes without errors
2. Server compiles and starts (check ./tmp/air-combined.log)
3. Manual verification of both edit buttons
</verification>

<success_criteria>
- Tags page Edit button opens modal with tag name/color pre-filled
- Correspondents page Edit button opens modal with correspondent name/notes pre-filled
- No JavaScript console errors when clicking Edit buttons
</success_criteria>

<output>
After completion, create `.planning/phases/15-pending-fixes/15-04-SUMMARY.md`
</output>
