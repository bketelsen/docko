---
phase: 10-templui-refactor
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/pages/admin/inboxes.templ
  - templates/pages/admin/network_sources.templ
  - templates/pages/admin/ai_settings.templ
autonomous: true

must_haves:
  truths:
    - "Form inputs use templUI input component"
    - "Form labels use templUI label component"
    - "Select elements use templUI selectbox component"
    - "Submit buttons use templUI button component"
    - "Checkbox inputs use proper templUI-consistent styling"
    - "All forms submit correctly with HTMX"
  artifacts:
    - path: "templates/pages/admin/inboxes.templ"
      provides: "Inbox form with templUI components"
      contains: "input.Input"
    - path: "templates/pages/admin/network_sources.templ"
      provides: "Network source form with templUI components"
      contains: "input.Input"
    - path: "templates/pages/admin/ai_settings.templ"
      provides: "AI settings form with templUI components"
      contains: "input.Input"
  key_links:
    - from: "templates/pages/admin/inboxes.templ"
      to: "components/input/input.templ"
      via: "import and component usage"
      pattern: 'input\.Input'
---

<objective>
Replace custom form elements with templUI components in settings pages

Purpose: Standardize all form inputs, labels, selects, and buttons to use templUI components for visual consistency and proper focus/hover states.

Output: Inboxes, Network Sources, and AI Settings pages with templUI form components
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-templui-refactor/10-CONTEXT.md
@.planning/phases/10-templui-refactor/10-RESEARCH.md

@templates/pages/admin/inboxes.templ
@templates/pages/admin/network_sources.templ
@templates/pages/admin/ai_settings.templ
@templates/pages/admin/login.templ (reference for templUI form patterns)
@components/input/input.templ
@components/label/label.templ
@components/button/button.templ
@components/selectbox/selectbox.templ
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Inboxes page forms</name>
  <files>templates/pages/admin/inboxes.templ</files>
  <action>
Replace all custom form elements in inboxes.templ:

1. Add templUI imports at top:
   ```go
   import "docko/components/input"
   import "docko/components/label"
   import "docko/components/button"
   import "docko/components/selectbox"
   ```

2. Replace "Add New Inbox" form fields:

   a) Name input:
   ```go
   <div class="space-y-2">
       @label.Label(label.Props{For: "name"}) { Name }
       @input.Input(input.Props{
           ID:          "name",
           Type:        input.TypeText,
           Name:        "name",
           Placeholder: "My Documents",
           Attributes:  templ.Attributes{"required": "true"},
       })
   </div>
   ```

   b) Path input - same pattern with appropriate placeholder

   c) Error path input - same pattern, no required attribute

   d) Duplicate action - use native select for now (selectbox requires more complex setup with HTMX), but style consistently:
   ```go
   <div class="space-y-2">
       @label.Label(label.Props{For: "duplicate_action"}) { Duplicate Handling }
       <select
           id="duplicate_action"
           name="duplicate_action"
           class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-xs transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
       >
           <option value="delete">Delete duplicate files</option>
           <option value="rename">Rename with timestamp</option>
           <option value="skip">Skip (leave in place)</option>
       </select>
   </div>
   ```

3. Replace submit button:
   ```go
   @button.Button(button.Props{
       Type: button.TypeSubmit,
   }) {
       Add Inbox
   }
   ```

4. Add `@input.Script()` at the end (before closing Admin layout)

5. Keep the HTMX attributes on the form element itself (hx-post, hx-target, hx-swap, hx-on::after-request)

Note: The toggle switches and delete buttons in InboxCard will be addressed in Plan 04.
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /inboxes and verify:
  - Form renders with templUI styled inputs
  - Labels are properly associated with inputs
  - Adding a new inbox works (HTMX submission)
  - Form resets after successful submission
  </verify>
  <done>
- Inboxes form uses templUI input, label, and button components
- Form submission still works via HTMX
- Visual styling matches templUI design system
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor Network Sources page forms</name>
  <files>templates/pages/admin/network_sources.templ</files>
  <action>
Replace all custom form elements in network_sources.templ:

1. Add templUI imports at top (same as inboxes)

2. Replace "Add Network Source" form fields:

   a) Name input - use templUI input with label

   b) Protocol select - use styled native select:
   ```go
   <div class="space-y-2">
       @label.Label(label.Props{For: "protocol"}) { Protocol }
       <select
           id="protocol"
           name="protocol"
           onchange="toggleCredentials(this)"
           class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-xs transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
       >
           <option value="smb">SMB (Windows/Samba)</option>
           <option value="nfs">NFS</option>
       </select>
   </div>
   ```

   c) Host input - use templUI input

   d) Share path input - use templUI input

   e) Username input - use templUI input (in smb-credentials div)

   f) Password input - use templUI input with TypePassword

   g) Post import action select - styled native select

   h) Duplicate action select - styled native select

   i) Continuous sync checkbox - style consistently:
   ```go
   <div class="flex items-center space-x-2">
       <input
           type="checkbox"
           id="continuous_sync"
           name="continuous_sync"
           value="true"
           checked
           class="h-4 w-4 rounded border-input text-primary focus:ring-primary"
       />
       @label.Label(label.Props{For: "continuous_sync"}) { Continuous sync (every 5 minutes) }
   </div>
   ```

   j) Batch size input - use templUI input with TypeNumber

3. Replace submit button with templUI button

4. Replace "Sync All" button at top:
   ```go
   @button.Button(button.Props{
       Variant: button.VariantSecondary,
       Attributes: templ.Attributes{
           "hx-post":              "/network-sources/sync-all",
           "hx-swap":              "none",
           "hx-on::after-request": "showToast(event.detail.xhr.responseText, !event.detail.successful)",
       },
   }) {
       Sync All
   }
   ```

5. Add `@input.Script()` at the end

6. Keep the toggleCredentials JavaScript function and showToast function
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /network-sources and verify:
  - Form renders with templUI styled inputs
  - Protocol dropdown toggles credentials fields
  - Adding a network source works
  - Sync All button works
  </verify>
  <done>
- Network Sources form uses templUI input, label, and button components
- Protocol toggle JavaScript still works
- Form submission works via HTMX
- Sync All button styled consistently
  </done>
</task>

<task type="auto">
  <name>Task 3: Refactor AI Settings page forms</name>
  <files>templates/pages/admin/ai_settings.templ</files>
  <action>
Replace all custom form elements in ai_settings.templ:

1. Add templUI imports:
   ```go
   import "docko/components/input"
   import "docko/components/label"
   import "docko/components/button"
   import "docko/components/card"
   ```

2. Wrap the settings form section in templUI card (optional, if desired for consistency with login page) OR keep existing bg-white styling but update form elements.

3. Replace form fields:

   a) Preferred Provider select - styled native select:
   ```go
   <div class="space-y-2">
       @label.Label(label.Props{For: "preferred_provider"}) { Preferred Provider }
       <select
           name="preferred_provider"
           class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-xs transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
       >
           // options
       </select>
       <p class="text-sm text-muted-foreground">Select which provider to use first.</p>
   </div>
   ```

   b) Max Pages input:
   ```go
   <div class="space-y-2">
       @label.Label(label.Props{For: "max_pages"}) { Max Pages to Analyze }
       @input.Input(input.Props{
           Name:       "max_pages",
           Type:       input.TypeNumber,
           Attributes: templ.Attributes{"min": "1", "max": "50", "value": strconv.Itoa(int(settings.MaxPages))},
           Class:      "w-32",
       })
       <p class="text-sm text-muted-foreground">Only analyze the first N pages.</p>
   </div>
   ```

   c) Auto-Apply Threshold input - same pattern with step="0.05"

   d) Review Threshold input - same pattern

   e) Auto Process checkbox:
   ```go
   <div class="flex items-center space-x-2">
       <input
           type="checkbox"
           name="auto_process"
           id="auto_process"
           checked?={ settings.AutoProcess }
           class="h-4 w-4 rounded border-input text-primary focus:ring-primary"
       />
       @label.Label(label.Props{For: "auto_process"}) { Auto-process new documents }
   </div>
   ```

   f) Minimum Word Count input - same pattern as Max Pages

4. Replace submit button:
   ```go
   @button.Button(button.Props{
       Type: button.TypeSubmit,
   }) {
       Save Settings
   }
   ```

5. Replace the "Review Suggestions" link button if pending:
   ```go
   @button.Button(button.Props{
       Href: "/ai/review",
       Variant: button.VariantDefault,
       Class: "bg-yellow-500 hover:bg-yellow-600",
   }) {
       // icon + text
   }
   ```

6. Update provider cards to use consistent styling with theme colors instead of hard-coded gray-* colors:
   - Replace `text-gray-900 dark:text-gray-100` with `text-foreground`
   - Replace `bg-white dark:bg-gray-800` with `bg-card`
   - Replace `text-gray-500 dark:text-gray-400` with `text-muted-foreground`

7. Add `@input.Script()` at the end
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /ai and verify:
  - Settings form renders with templUI styled inputs
  - Provider status cards render correctly
  - Save Settings works
  - Review Suggestions link works (if pending suggestions exist)
  </verify>
  <done>
- AI Settings form uses templUI input, label, and button components
- Form submission works via HTMX
- Color scheme uses theme variables instead of hard-coded colors
- Visual consistency with rest of application
  </done>
</task>

</tasks>

<verification>
1. Application compiles without errors
2. All three settings pages render correctly
3. Form submissions work (add inbox, add network source, save AI settings)
4. HTMX interactions preserved
5. JavaScript functionality preserved (toggleCredentials, showToast)
6. Dark mode works correctly on all pages
</verification>

<success_criteria>
- Inboxes, Network Sources, and AI Settings use templUI form components
- All form inputs have consistent styling
- Labels are properly associated with inputs
- Form validation and submission work
- No visual or functional regressions
</success_criteria>

<output>
After completion, create `.planning/phases/10-templui-refactor/10-02-SUMMARY.md`
</output>
