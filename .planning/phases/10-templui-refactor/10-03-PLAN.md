---
phase: 10-templui-refactor
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/pages/admin/tags.templ
  - templates/pages/admin/correspondents.templ
  - templates/pages/admin/documents.templ
autonomous: true

must_haves:
  truths:
    - "Tags page form uses templUI components"
    - "Tags modal uses templUI dialog component"
    - "Correspondents page form uses templUI components"
    - "Documents search form uses templUI components"
    - "Tag filter checkboxes are styled consistently"
  artifacts:
    - path: "templates/pages/admin/tags.templ"
      provides: "Tags page with templUI form and dialog"
      contains: "dialog.Dialog"
    - path: "templates/pages/admin/documents.templ"
      provides: "Documents page with templUI search form"
      contains: "input.Input"
  key_links:
    - from: "templates/pages/admin/tags.templ"
      to: "components/dialog/dialog.templ"
      via: "import and component usage"
      pattern: 'dialog\.Dialog'
---

<objective>
Replace custom forms and modal in Tags, Correspondents, and Documents pages

Purpose: Standardize the tag/correspondent management forms and the custom tag modal to use templUI components, plus update the documents search interface.

Output: Tags, Correspondents, and Documents pages with templUI form components and dialog
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-templui-refactor/10-CONTEXT.md
@.planning/phases/10-templui-refactor/10-RESEARCH.md

@templates/pages/admin/tags.templ
@templates/pages/admin/correspondents.templ
@templates/pages/admin/documents.templ
@components/dialog/dialog.templ
@components/input/input.templ
@components/button/button.templ
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Tags page with templUI dialog</name>
  <files>templates/pages/admin/tags.templ</files>
  <action>
Replace the custom modal and form elements in tags.templ:

1. Add templUI imports:
   ```go
   import "docko/components/button"
   import "docko/components/input"
   import "docko/components/label"
   import "docko/components/dialog"
   ```

2. Replace the "Add Tag" button to trigger dialog:
   ```go
   @button.Button(button.Props{
       Attributes: templ.Attributes{
           "onclick": "openTagModal()",
       },
   }) {
       Add Tag
   }
   ```

3. Replace the custom modal with templUI dialog structure.

   **Important:** The current modal uses JavaScript to dynamically switch between create/edit modes. templUI dialog is more declarative. Options:

   a) Keep the JavaScript approach but use templUI dialog styling:
   ```go
   @dialog.Dialog(dialog.Props{ID: "tag-modal"}) {
       @dialog.Content() {
           @dialog.Header() {
               @dialog.Title() { Create Tag }
               @dialog.Description() { Add a new tag for organizing documents. }
           }
           <form id="tag-form" hx-post="/tags" hx-target="#tag-list" hx-swap="beforeend">
               <div class="space-y-4 py-4">
                   <div class="space-y-2">
                       @label.Label(label.Props{For: "tag-name"}) { Name }
                       @input.Input(input.Props{
                           ID:          "tag-name",
                           Name:        "name",
                           Placeholder: "Enter tag name",
                           Attributes:  templ.Attributes{"required": "true"},
                       })
                   </div>
                   <div class="space-y-2">
                       @label.Label() { Color }
                       <div class="grid grid-cols-6 gap-2">
                           for _, color := range TagColors {
                               <label class="cursor-pointer">
                                   <input type="radio" name="color" value={ color.Name } class="sr-only peer"/>
                                   <div class={ "w-8 h-8 rounded-full transition-all peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-ring", color.BgClass } title={ color.Name }></div>
                               </label>
                           }
                       </div>
                   </div>
               </div>
               @dialog.Footer() {
                   @dialog.Close() {
                       @button.Button(button.Props{Variant: button.VariantOutline, Type: button.TypeButton}) {
                           Cancel
                       }
                   }
                   @button.Button(button.Props{Type: button.TypeSubmit}) {
                       Create
                   }
               }
           </form>
       }
   }
   @dialog.Script()
   ```

4. Update the JavaScript to work with templUI dialog:
   - templUI dialog uses `data-tui-state="open"` attribute
   - Open: `document.getElementById('tag-modal').setAttribute('data-tui-state', 'open')`
   - Close: `document.getElementById('tag-modal').removeAttribute('data-tui-state')`
   - Or use the templUI dialog's built-in trigger mechanism

5. Update TagCard action buttons to use templUI button:
   ```go
   @button.Button(button.Props{
       Variant: button.VariantGhost,
       Size:    button.SizeIcon,
       Attributes: templ.Attributes{
           "onclick": editTagOnClick(tag),
           "title":   "Edit tag",
       },
   }) {
       // Edit icon SVG
   }

   @button.Button(button.Props{
       Variant: button.VariantGhost,
       Size:    button.SizeIcon,
       Attributes: templ.Attributes{
           "hx-delete":  fmt.Sprintf("/tags/%s", tag.ID.String()),
           "hx-target":  fmt.Sprintf("#tag-%s", tag.ID.String()),
           "hx-swap":    "outerHTML",
           "hx-confirm": confirmMsg,
           "title":      "Delete tag",
       },
   }) {
       // Delete icon SVG
   }
   ```

6. Add `@input.Script()` for input components
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /tags and verify:
  - "Add Tag" button opens dialog
  - Tag name input and color picker work
  - Creating a tag works (appears in list)
  - Edit button opens dialog in edit mode
  - Delete button works with confirmation
  - Dialog closes after successful submission
  </verify>
  <done>
- Tags page uses templUI dialog for create/edit modal
- Form inputs use templUI input and label components
- Action buttons use templUI button component
- All CRUD operations work correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor Correspondents page forms</name>
  <files>templates/pages/admin/correspondents.templ</files>
  <action>
Replace custom form elements in correspondents.templ (similar pattern to tags):

1. Add templUI imports (same as tags)

2. If correspondents has a similar modal structure, apply same dialog pattern

3. Replace action buttons with templUI button:
   - Edit button
   - Delete button
   - Merge mode buttons (if any)

4. Replace any form inputs with templUI input component

5. If there's a correspondent card similar to TagCard, update buttons consistently

6. Add necessary Script() calls

Note: Review the correspondents.templ file structure first - it may follow the same pattern as tags.templ or have different requirements (merge functionality).
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /correspondents and verify:
  - Correspondent list renders correctly
  - Add/edit functionality works (if modal exists)
  - Delete functionality works
  - Merge mode works (if applicable)
  </verify>
  <done>
- Correspondents page uses templUI form components
- Action buttons use templUI button component
- All CRUD and merge operations work correctly
  </done>
</task>

<task type="auto">
  <name>Task 3: Refactor Documents search form</name>
  <files>templates/pages/admin/documents.templ</files>
  <action>
Replace custom search form elements in documents.templ:

1. Add templUI imports:
   ```go
   import "docko/components/input"
   import "docko/components/button"
   ```

2. Replace the search input in DocumentsWithSearch:
   ```go
   <div class="relative flex-1">
       <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none z-10" .../>
       @input.Input(input.Props{
           Type:        input.TypeSearch,
           Name:        "q",
           Placeholder: "Search documents...",
           Class:       "pl-10 pr-10",
           Attributes:  templ.Attributes{"value": params.Query},
       })
       // Loading indicator span stays as-is
   </div>
   ```

3. Replace correspondent filter dropdown with styled native select (consistent with other pages):
   ```go
   <select
       name="correspondent"
       class="flex h-9 min-w-[180px] rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-xs transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
   >
       // options
   </select>
   ```

4. Replace date range filter dropdown with same styled select pattern

5. Keep the tag filter checkboxes but update styling to be consistent:
   ```go
   templ tagFilterCheckbox(tag sqlc.Tag, selectedTagIDs []string) {
       // ... isSelected logic ...
       <label class={ "inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-sm cursor-pointer transition-colors border",
           templ.KV("bg-primary text-primary-foreground border-primary", isSelected),
           templ.KV("bg-transparent hover:bg-muted border-input", !isSelected) }>
           <input type="checkbox" name="tag" value={ tag.ID.String() } checked?={ isSelected } class="sr-only"/>
           // color dot and name
       </label>
   }
   ```

6. Replace the "Upload" link button:
   ```go
   @button.Button(button.Props{
       Href: "/upload",
   }) {
       // icon + "Upload"
   }
   ```

7. Add `@input.Script()` at the end

8. Keep all HTMX attributes on the form (hx-get, hx-trigger, hx-target, etc.)
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /documents and verify:
  - Search input renders correctly with icon
  - Search works (type and wait for debounce)
  - Correspondent dropdown filters correctly
  - Date range dropdown filters correctly
  - Tag checkboxes filter correctly (AND logic)
  - Upload button links to /upload
  - Loading indicator shows during HTMX requests
  </verify>
  <done>
- Documents search form uses templUI input component
- Dropdown selects have consistent styling
- Tag filter checkboxes have improved styling
- All search and filter functionality works
- HTMX interactions preserved
  </done>
</task>

</tasks>

<verification>
1. Application compiles without errors
2. Tags page dialog works for create/edit
3. Correspondents page forms work correctly
4. Documents search and filters work correctly
5. All HTMX interactions preserved
6. Dark mode works on all pages
</verification>

<success_criteria>
- Tags page uses templUI dialog component
- All three pages use templUI form components
- Action buttons use templUI button component
- Modal open/close functionality works
- All CRUD operations work correctly
- Search and filter functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/10-templui-refactor/10-03-SUMMARY.md`
</output>
