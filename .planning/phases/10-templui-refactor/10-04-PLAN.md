---
phase: 10-templui-refactor
plan: 04
type: execute
wave: 2
depends_on: ["10-02", "10-03"]
files_modified:
  - templates/pages/admin/documents.templ
  - templates/partials/search_results.templ
  - templates/partials/document_status.templ
  - templates/pages/admin/document_detail.templ
autonomous: true

must_haves:
  truths:
    - "Document tables use templUI table component"
    - "Status badges use templUI badge component"
    - "Table rows are interactive (links work)"
    - "SSE status updates still work"
    - "Pagination buttons styled consistently"
  artifacts:
    - path: "templates/partials/search_results.templ"
      provides: "Search results with templUI table"
      contains: "table.Table"
    - path: "templates/partials/document_status.templ"
      provides: "Status badge using templUI badge"
      contains: "badge.Badge"
  key_links:
    - from: "templates/partials/search_results.templ"
      to: "components/table/table.templ"
      via: "import and component usage"
      pattern: 'table\.Table'
    - from: "templates/partials/document_status.templ"
      to: "components/badge/badge.templ"
      via: "import and component usage"
      pattern: 'badge\.Badge'
---

<objective>
Replace document tables and status badges with templUI components

Purpose: Standardize the document list tables to use templUI table component for consistent styling and the status indicators to use templUI badge component.

Output: Document tables and status badges using templUI components
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-templui-refactor/10-CONTEXT.md
@.planning/phases/10-templui-refactor/10-RESEARCH.md

@templates/pages/admin/documents.templ
@templates/partials/search_results.templ
@templates/partials/document_status.templ
@templates/pages/admin/document_detail.templ
@components/table/table.templ
@components/badge/badge.templ
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace document status badges with templUI badge</name>
  <files>templates/partials/document_status.templ, templates/pages/admin/document_detail.templ</files>
  <action>
Update document status badges to use templUI badge component:

**1. Update document_status.templ:**

Add import:
```go
import "docko/components/badge"
import "docko/components/button"
```

Replace the DocumentStatus template:
```go
templ DocumentStatus(docID string, status string, errorMsg string) {
    <div id={ "status-" + docID } class="inline-flex items-center gap-1">
        if status == "pending" {
            @badge.Badge(badge.Props{Variant: badge.VariantSecondary}) {
                Pending
            }
        } else if status == "processing" {
            @badge.Badge(badge.Props{Variant: badge.VariantDefault, Class: "animate-pulse"}) {
                Processing...
            }
        } else if status == "completed" {
            @badge.Badge(badge.Props{Variant: badge.VariantDefault, Class: "bg-green-600 hover:bg-green-600"}) {
                Complete
            }
        } else if status == "failed" {
            @badge.Badge(badge.Props{Variant: badge.VariantDestructive}) {
                Failed
            }
            if errorMsg != "" {
                <span class="text-xs text-destructive cursor-help" title={ errorMsg }>(?)</span>
            }
            @button.Button(button.Props{
                Variant: button.VariantLink,
                Size:    button.SizeSm,
                Attributes: templ.Attributes{
                    "hx-post":   "/api/documents/" + docID + "/retry",
                    "hx-swap":   "outerHTML",
                    "hx-target": "#status-" + docID,
                },
            }) {
                Retry
            }
        }
    }
}
```

**2. Update document_detail.templ statusBadge:**

Replace the local statusBadge template:
```go
templ statusBadge(status string) {
    switch status {
        case "completed":
            @badge.Badge(badge.Props{Variant: badge.VariantDefault, Class: "bg-green-500/10 text-green-500 border-green-500/20"}) {
                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                Completed
            }
        case "processing":
            @badge.Badge(badge.Props{Variant: badge.VariantDefault, Class: "bg-blue-500/10 text-blue-500 border-blue-500/20"}) {
                <svg class="w-3 h-3 mr-1 animate-spin" fill="none" viewBox="0 0 24 24">
                    // spinner svg
                </svg>
                Processing
            }
        case "failed":
            @badge.Badge(badge.Props{Variant: badge.VariantDestructive}) {
                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    // x circle svg
                </svg>
                Failed
            }
        default:
            @badge.Badge(badge.Props{Variant: badge.VariantSecondary}) {
                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    // clock svg
                </svg>
                Pending
            }
    }
}
```

Also add badge import to document_detail.templ

Note: The badge component allows custom Class prop to override colors when needed.
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /documents and verify:
  - Status badges render correctly
  - Pending = secondary (gray)
  - Processing = primary with animation
  - Completed = green variant
  - Failed = destructive (red) with retry button
- Visit a document detail page and verify status badge
- Check that SSE status updates still work (if processing documents)
  </verify>
  <done>
- document_status.templ uses templUI badge component
- document_detail.templ statusBadge uses templUI badge component
- Badge variants match status semantics
- Retry button works for failed documents
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace document tables with templUI table</name>
  <files>templates/partials/search_results.templ, templates/pages/admin/documents.templ</files>
  <action>
Update document tables to use templUI table component:

**1. Update search_results.templ:**

Add import:
```go
import "docko/components/table"
```

Replace the table in SearchResults template:
```go
<div class="border border-border rounded-lg overflow-hidden">
    @table.Table() {
        @table.Header() {
            @table.Row() {
                @table.Head() { Document }
                @table.Head() { Tags }
                @table.Head() { Correspondent }
                @table.Head() { Date }
                @table.Head() { Status }
            }
        }
        @table.Body() {
            for _, result := range results {
                @table.Row(table.RowProps{
                    Attributes: templ.Attributes{
                        "class": "hover:bg-muted/50",
                    },
                }) {
                    @table.Cell() {
                        <div class="flex items-start gap-3">
                            // PDF icon SVG
                            <div class="min-w-0">
                                <a href={ templ.SafeURL("/documents/" + result.ID.String()) } class="block truncate hover:text-primary hover:underline font-medium" title={ result.OriginalFilename }>
                                    { result.OriginalFilename }
                                </a>
                                if result.Headline != "" {
                                    <p class="text-sm text-muted-foreground mt-1 line-clamp-2">
                                        @templ.Raw(result.Headline)
                                    </p>
                                }
                            </div>
                        </div>
                    }
                    @table.Cell() {
                        @InlineTagPicker(result.ID.String(), getResultTags(docTags, result.ID))
                    }
                    @table.Cell() {
                        @InlineCorrespondentDisplay(result.CorrespondentName)
                    }
                    @table.Cell(table.CellProps{Class: "text-muted-foreground"}) {
                        { formatDocDate(result.DocumentDate) }
                    }
                    @table.Cell() {
                        @DocumentStatus(result.ID.String(), string(result.ProcessingStatus), derefStrPtr(result.ProcessingError))
                    }
                }
            }
        }
    }
</div>
```

**2. Update pagination buttons in search_results.templ:**

Replace pagination buttons with templUI button:
```go
@button.Button(button.Props{
    Variant: button.VariantOutline,
    Size:    button.SizeSm,
    Attributes: templ.Attributes{
        "hx-get":      buildPaginationURL(params, currentPage-1),
        "hx-target":   "#document-results",
        "hx-push-url": "true",
    },
}) {
    Previous
}
```

**3. Update documents.templ (legacy Documents template):**

Replace the table in the Documents template (if still used) with same pattern:
- Use table.Table, table.Header, table.Body, table.Row, table.Head, table.Cell

Note: Make sure SSE swap targets still work - the sse-swap attribute should be on a div inside the table cell, not on the row itself.
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /documents and verify:
  - Table renders with templUI styling
  - Table headers aligned correctly
  - Table rows have hover states
  - Document links work
  - Tag picker works
  - Correspondent display works
  - Status badges work
  - Pagination buttons work
  - SSE status updates still work (test with a processing document)
  </verify>
  <done>
- search_results.templ uses templUI table component
- documents.templ (legacy) uses templUI table component
- Pagination buttons use templUI button component
- Table styling is consistent with templUI design system
- All interactive elements still work
  </done>
</task>

<task type="auto">
  <name>Task 3: Update document detail page buttons</name>
  <files>templates/pages/admin/document_detail.templ</files>
  <action>
Update action buttons in document_detail.templ to use templUI button:

1. Add button import (if not already):
```go
import "docko/components/button"
```

2. Replace "View PDF" button:
```go
@button.Button(button.Props{
    Attributes: templ.Attributes{
        "hx-get":    "/documents/" + doc.ID.String() + "/viewer",
        "hx-target": "body",
        "hx-swap":   "beforeend",
    },
}) {
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // eye icon
    </svg>
    View PDF
}
```

3. Replace "Download" button:
```go
@button.Button(button.Props{
    Variant: button.VariantOutline,
    Href:    fmt.Sprintf("/documents/%s/download", doc.ID.String()),
}) {
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // download icon
    </svg>
    Download
}
```

4. Replace quick action buttons below thumbnail:
```go
@button.Button(button.Props{
    Variant: button.VariantOutline,
    Size:    button.SizeSm,
    Href:    fmt.Sprintf("/documents/%s/view", doc.ID.String()),
    Attributes: templ.Attributes{
        "target": "_blank",
        "title":  "Open in new tab",
    },
}) {
    <svg class="w-4 h-4 mr-1" .../>
    Open
}

@button.Button(button.Props{
    Variant: button.VariantOutline,
    Size:    button.SizeSm,
    Href:    fmt.Sprintf("/documents/%s/download", doc.ID.String()),
    Attributes: templ.Attributes{
        "title": "Download file",
    },
}) {
    <svg class="w-4 h-4 mr-1" .../>
    Download
}
```

5. Keep tabs and breadcrumbs as-is (already using templUI components)
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit a document detail page and verify:
  - "View PDF" button opens modal
  - "Download" button downloads file
  - Quick action buttons below thumbnail work
  - Status badge renders correctly
  - Tabs work (Overview/Technical)
  </verify>
  <done>
- Document detail page action buttons use templUI button component
- All button variants appropriate (primary for main action, outline for secondary)
- All functionality preserved
  </done>
</task>

</tasks>

<verification>
1. Application compiles without errors
2. Status badges render correctly on all pages
3. Tables render correctly with proper styling
4. All interactive elements work (links, buttons, pickers)
5. SSE status updates work
6. Pagination works
7. Document detail page fully functional
</verification>

<success_criteria>
- document_status.templ uses templUI badge component
- search_results.templ uses templUI table component
- document_detail.templ uses templUI button and badge components
- All HTMX interactions preserved
- SSE real-time updates work
- Visual consistency achieved
</success_criteria>

<output>
After completion, create `.planning/phases/10-templui-refactor/10-04-SUMMARY.md`
</output>
