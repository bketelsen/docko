---
phase: 10-templui-refactor
plan: 05
type: execute
wave: 2
depends_on: ["10-02"]
files_modified:
  - templates/pages/admin/inboxes.templ
  - templates/pages/admin/network_sources.templ
  - templates/pages/admin/login.templ
autonomous: true

must_haves:
  truths:
    - "Error alerts use templUI alert component"
    - "Toggle switches use consistent styling"
    - "Toast notifications work correctly"
    - "Delete buttons use templUI button component"
    - "Card-style containers use consistent styling"
  artifacts:
    - path: "templates/pages/admin/inboxes.templ"
      provides: "Inbox cards with templUI alert and button"
      contains: "alert.Alert"
    - path: "templates/pages/admin/network_sources.templ"
      provides: "Network source cards with templUI alert and button"
      contains: "alert.Alert"
  key_links:
    - from: "templates/pages/admin/inboxes.templ"
      to: "components/alert/alert.templ"
      via: "import and component usage"
      pattern: 'alert\.Alert'
---

<objective>
Replace alerts, switches, and card action buttons with templUI components

Purpose: Standardize error alerts, toggle switches, and action buttons in inbox/network source cards to use templUI components for visual consistency.

Output: Inbox and network source cards with templUI alert, button, and consistent toggle styling
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-templui-refactor/10-CONTEXT.md
@.planning/phases/10-templui-refactor/10-RESEARCH.md

@templates/pages/admin/inboxes.templ
@templates/pages/admin/network_sources.templ
@templates/pages/admin/login.templ
@components/alert/alert.templ
@components/button/button.templ
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace inbox card alerts and buttons</name>
  <files>templates/pages/admin/inboxes.templ</files>
  <action>
Update InboxCard to use templUI alert and button components:

1. Add imports (if not already added from Plan 02):
```go
import "docko/components/alert"
import "docko/components/button"
```

2. Replace the error message div with templUI alert:
```go
// Old:
if inbox.LastError != nil {
    <div class="p-3 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-md text-sm text-red-700 dark:text-red-300 mb-4">
        <strong>Last error:</strong> { *inbox.LastError }
    </div>
}

// New:
if inbox.LastError != nil {
    @alert.Alert(alert.Props{Variant: alert.VariantDestructive}) {
        @alert.Title() { Last error }
        @alert.Description() { { *inbox.LastError } }
    }
}
```

3. Replace the toggle switch button. Since templUI doesn't have a dedicated switch component, use a consistently styled button that looks like a switch:
```go
// Keep the existing toggle structure but ensure consistent styling:
<button
    hx-post={ fmt.Sprintf("/inboxes/%s/toggle", inbox.ID.String()) }
    hx-target={ fmt.Sprintf("#inbox-%s", inbox.ID.String()) }
    hx-swap="outerHTML"
    class={ "relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        templ.KV("bg-primary", inbox.Enabled),
        templ.KV("bg-input", !inbox.Enabled) }
    title={ toggleTitle(inbox.Enabled) }
    role="switch"
    aria-checked={ fmt.Sprintf("%t", inbox.Enabled) }
>
    <span
        class={ "inline-block h-4 w-4 transform rounded-full bg-background shadow-sm transition-transform",
            templ.KV("translate-x-6", inbox.Enabled),
            templ.KV("translate-x-1", !inbox.Enabled) }
    ></span>
</button>
```

4. Replace the delete button with templUI button:
```go
@button.Button(button.Props{
    Variant: button.VariantGhost,
    Size:    button.SizeIcon,
    Attributes: templ.Attributes{
        "hx-delete":  fmt.Sprintf("/inboxes/%s", inbox.ID.String()),
        "hx-target":  fmt.Sprintf("#inbox-%s", inbox.ID.String()),
        "hx-swap":    "outerHTML",
        "hx-confirm": "Delete this inbox? The directory and its files will not be affected.",
        "title":      "Delete inbox",
    },
}) {
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
    </svg>
}
```

5. Update the status indicator to use consistent colors:
```go
// Keep the colored dots but ensure they use theme-aware colors where possible:
if inbox.Enabled && inbox.LastError == nil {
    <div class="w-3 h-3 rounded-full bg-green-500" title="Healthy"></div>
} else if inbox.LastError != nil {
    <div class="w-3 h-3 rounded-full bg-destructive" title="Error"></div>
} else {
    <div class="w-3 h-3 rounded-full bg-muted-foreground/50" title="Disabled"></div>
}
```

6. Update the "Add New Inbox" section header to use card styling consistent with other pages:
```go
<div class="border border-border rounded-lg p-6 mb-6 bg-card">
    <h2 class="text-lg font-semibold mb-4 text-card-foreground">Add New Inbox</h2>
    // form...
</div>
```
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /inboxes and verify:
  - Error alerts render with templUI styling
  - Toggle switches work and have focus states
  - Delete buttons work with confirmation
  - Status indicators show correct colors
  - Add inbox form has consistent card styling
  </verify>
  <done>
- InboxCard error messages use templUI alert component
- Toggle switches have consistent styling with accessibility attributes
- Delete buttons use templUI button component
- Status indicators use theme-aware colors
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace network source card alerts and buttons</name>
  <files>templates/pages/admin/network_sources.templ</files>
  <action>
Update NetworkSourceCard with same patterns as inbox cards:

1. Add imports (if not already added)

2. Replace the error message div with templUI alert:
```go
if source.LastError != nil && *source.LastError != "" {
    @alert.Alert(alert.Props{Variant: alert.VariantDestructive, Class: "mb-4"}) {
        @alert.Title() { Last error }
        @alert.Description() {
            { *source.LastError }
            if source.ConsecutiveFailures >= 5 {
                <span class="ml-2 text-xs opacity-75">(auto-disabled after { fmt.Sprintf("%d", source.ConsecutiveFailures) } failures)</span>
            }
        }
    }
}
```

3. Replace action buttons with templUI button:

   a) Test connection button:
   ```go
   @button.Button(button.Props{
       Variant: button.VariantGhost,
       Size:    button.SizeIcon,
       Class:   "test-btn",
       Attributes: templ.Attributes{
           "hx-post":              fmt.Sprintf("/network-sources/%s/test", source.ID.String()),
           "hx-swap":              "none",
           "hx-on::after-request": "showToast(event.detail.xhr.responseText, !event.detail.successful)",
           "title":                "Test connection",
       },
   }) {
       // Spinner (hidden) and test icon
   }
   ```

   b) Sync now button:
   ```go
   @button.Button(button.Props{
       Variant: button.VariantGhost,
       Size:    button.SizeIcon,
       Attributes: templ.Attributes{
           "hx-post":              fmt.Sprintf("/network-sources/%s/sync", source.ID.String()),
           "hx-swap":              "none",
           "hx-on::after-request": "showToast(event.detail.xhr.responseText, !event.detail.successful)",
           "title":                "Sync now",
       },
   }) {
       // Upload icon
   }
   ```

   c) Delete button (same pattern as inbox)

4. Apply same toggle switch styling as inbox card

5. Update status indicator colors same as inbox

6. Update the protocol badge to use templUI badge (already have it installed):
```go
import "docko/components/badge"

// In NetworkSourceCard:
@badge.Badge(badge.Props{Variant: badge.VariantSecondary, Class: "uppercase text-xs"}) {
    { string(source.Protocol) }
}
```

7. Update the toast container or consider using templUI toast (already installed but may need setup)

8. Update card container styling:
```go
<div class="border border-border rounded-lg p-6 mb-6 bg-card">
    // form...
</div>
```
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /network-sources and verify:
  - Error alerts render with templUI styling
  - Test connection button works and shows toast
  - Sync now button works and shows toast
  - Toggle switch works
  - Delete button works with confirmation
  - Protocol badge renders correctly
  - Status indicators show correct colors
  </verify>
  <done>
- NetworkSourceCard error messages use templUI alert component
- Action buttons use templUI button component
- Protocol badge uses templUI badge component
- Toggle switches have consistent styling
- All functionality preserved
  </done>
</task>

<task type="auto">
  <name>Task 3: Replace login page error alert</name>
  <files>templates/pages/admin/login.templ</files>
  <action>
Update the login page error message to use templUI alert:

1. Add import:
```go
import "docko/components/alert"
```

2. Replace the error div:
```go
// Old:
if errorMsg != "" {
    <div class="mb-4 p-3 rounded-md bg-destructive/15 text-destructive text-sm">
        { errorMsg }
    </div>
}

// New:
if errorMsg != "" {
    @alert.Alert(alert.Props{Variant: alert.VariantDestructive, Class: "mb-4"}) {
        @alert.Description() { { errorMsg } }
    }
}
```

Note: Login page already uses templUI card, input, label, and button components. This task only updates the error message display.
  </action>
  <verify>
- Check air-combined.log for compilation errors
- Visit /login and verify:
  - Try invalid credentials
  - Error message renders with templUI alert styling
  - Alert uses destructive variant (red border/text)
  </verify>
  <done>
- Login page error message uses templUI alert component
- Visual consistency with other error alerts in the application
  </done>
</task>

</tasks>

<verification>
1. Application compiles without errors
2. Error alerts render consistently across all pages
3. Toggle switches work with proper accessibility
4. Action buttons work with proper styling
5. Toasts work for network source operations
6. Dark mode works correctly on all updated elements
</verification>

<success_criteria>
- InboxCard and NetworkSourceCard use templUI alert for errors
- Toggle switches have consistent, accessible styling
- Action buttons use templUI button component
- Protocol badge uses templUI badge component
- Login error uses templUI alert
- All HTMX interactions preserved
</success_criteria>

<output>
After completion, create `.planning/phases/10-templui-refactor/10-05-SUMMARY.md`
</output>
